name: Update State Components in CustApp

on:
  repository_dispatch:
    types: [update-submodule]

jobs:
  update-state-components:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout CustApp repository without submodules
      - name: Checkout CustApp repository
        uses: actions/checkout@v3
        with:
          submodules: false  # Skip the default submodule checkout
          token: ${{ secrets.CUSTAPP_REPO_TOKEN }}  # Use the token to checkout the main repository

      # Step 2: Authenticate Git with Personal Access Token
      - name: Authenticate Git
        run: |
          git config --global url."https://${{ secrets.CUSTAPP_REPO_TOKEN }}:x-oauth-basic@github.com/".insteadOf "https://github.com/"

      # Step 3: Set Git User Identity
      - name: Set Git User Identity
        run: |
          git config --global user.email "veem@veem.com"
          git config --global user.name "CI Bot"

      # Step 4: Update state-components submodule to the latest commit
      - name: Update state-components submodule
        run: |
          git submodule update --init --recursive
          git submodule update --remote state-components
          git add state-components
          git commit -m "Update state-components submodule reference to the latest commit"
          git push

      # Step 5: Run lints
      - name: Run Lints
        run: |
          # Replace the following command with your lint command(s)
          # npm install
          # npm run lint

      # Step 6: Run tests
      - name: Run Tests
        run: |
          # Replace the following command with your test command(s)
          # npm run test

      # Step 7: Deploy Placeholder
      - name: Deploy CustApp Placeholder
        run: echo "Deploy CustApp Placeholder"
